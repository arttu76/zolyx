<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Zolyx</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { touch-action: none; overscroll-behavior: none; }
  body {
    background: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: monospace;
    color: #d7d700;
  }
  canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }
  #info {
    color: #aaa;
    font-size: 13px;
    margin-top: 12px;
    text-align: center;
    line-height: 1.6;
  }
  #info b { color: #fff; }

  /* Touch controls */
  #touch-controls {
    display: none;
    margin-top: 12px;
    width: 100%;
    max-width: 320px;
    padding: 0 8px;
    justify-content: space-between;
    align-items: center;
    -webkit-user-select: none;
    user-select: none;
  }
  @media (pointer: coarse) {
    body.has-touch #touch-controls { display: flex; }
    body.has-touch #info { display: none; }
  }
  #dpad {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }
  .dpad-mid {
    display: flex;
    align-items: center;
    gap: 2px;
  }
  .dpad-center {
    width: 52px;
    height: 52px;
  }
  .dpad-btn {
    width: 52px;
    height: 52px;
    border: none;
    border-radius: 6px;
    background: #333;
    color: #ccc;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: none;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
  }
  .dpad-btn:active, .dpad-btn.active { background: #555; }
  #action-buttons {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }
  #btn-fire {
    width: 80px;
    height: 80px;
    border: none;
    border-radius: 50%;
    background: #a00;
    color: #fff;
    font-size: 16px;
    font-weight: bold;
    font-family: monospace;
    touch-action: none;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
  }
  #btn-fire:active, #btn-fire.active { background: #d33; }
  #aux-buttons {
    display: flex;
    gap: 12px;
  }
  #aux-buttons button {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 6px;
    background: #333;
    color: #ccc;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: none;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
  }
  #aux-buttons button:active, #aux-buttons button.active { background: #555; }
</style>
  <script type="module" crossorigin>(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();const g=2,L=125,E=18,F=93,m=0,B=1,T=2,p=3,O=[1,1,0,-1,-1,-1,0,1],S=[0,1,1,1,0,-1,-1,-1],ve=396,ie=90,he=75,fe=3,ce=176,Q=14,xe=72,Ce=50,N=2,Ae=[{x:29,y:33},{x:61,y:33},{x:93,y:33},{x:29,y:53},{x:93,y:53},{x:29,y:73},{x:61,y:73},{x:93,y:73}],ge=[64,24,162,90,186,189,253,255,255,255,255,255,255,255,255,255],Ee=[128,128,128,128,128,128,192,192,192,192,192,192,192,192,192,192],$=[112,104,88,96,104,120,104,112,96,88,120,104,112,80,88,104],we=["#000000","#0000FF","#FF0000","#FF00FF","#00FF00","#00FFFF","#FFFF00","#FFFFFF"],Te=[{x:64,y:18,dir:0},{x:64,y:93,dir:4}],I=256,H=192,w=32,P=24,Oe=[[0,0],[85,0],[170,85],[255,255]],Se=50,ee=new Uint8Array(I*H),k=new Uint8Array(w*P);let U=null,X=null,j=null;function Le(){U=document.getElementById("game"),U.width=I,U.height=H,X=U.getContext("2d"),j=X.createImageData(I,H)}function Fe(){if(!X)throw new Error("Screen not initialized — call initScreen() first");return X}function Ie(){if(!j)throw new Error("Screen not initialized — call initScreen() first");return j}const t={grid:[],player:{x:g,y:E,dir:0,axisH:!1,drawing:!1,fastMode:!1,fillComplete:!1},trailBuffer:[],trailFrameCounter:0,chasers:[],sparks:[],trailCursor:{x:0,y:0,active:!1,bufferIndex:0},score:0,lives:fe,level:0,timer:ce,timerSub:Q,frameCounter:0,percentage:0,rawPercentage:0,fieldColor:"#FFFF00",gameOver:!1,gameOverOutOfTime:!1,gameOverFrame:0,levelComplete:!1,lcAnim:{active:!1,phase:0,frame:0,timerCountdown:0,subFrame:0},collision:!1,timerExpired:!1,paused:!1,deathAnimTimer:0,keys:{up:!1,down:!1,left:!1,right:!1,fire:!1}};function Re(){const e=[];for(let r=0;r<128;r++){e[r]=[];for(let i=0;i<128;i++)e[r][i]=m}for(let r=g;r<=L;r++)e[E][r]=p;for(let r=g;r<=L;r++)e[F][r]=p;for(let r=E;r<=F;r++)e[r][g]=p;for(let r=E;r<=F;r++)e[r][L]=p;t.grid=e}function v(e,r){return e<0||e>=128||r<0||r>=128?p:t.grid[r][e]}function _(e,r,i){e>=0&&e<128&&r>=0&&r<128&&(t.grid[r][e]=i)}function be(){let e=0;for(let r=E;r<=F;r++)for(let i=g;i<=L;i++)t.grid[r][i]!==m&&e++;return e}function _e(){let e=0;for(let r=E;r<=F;r++)for(let i=g;i<=L;i++)t.grid[r][i]===B&&e++;return e}function te(){const e=_e();t.rawPercentage=Math.floor(e/ie);const r=be();t.percentage=Math.floor((r-ve)/ie),t.percentage>=he&&(t.levelComplete=!0)}function De(){return t.score+(t.rawPercentage+t.percentage)*4}function Me(){return $[t.level&15]>>3&7}function G(){return Math.floor(Math.random()*256)}function Be(e){const i=$[e&15]>>3&7;return we[i]}function re(){t.level=0,t.score=0,t.lives=fe,t.gameOver=!1,t.gameOverOutOfTime=!1,t.gameOverFrame=0,ue()}function ue(){t.timer=ce,t.timerSub=Q,t.frameCounter=0,t.trailFrameCounter=0,t.levelComplete=!1,t.collision=!1,t.timerExpired=!1,t.deathAnimTimer=0,t.fieldColor=Be(t.level),Re(),t.player.x=g,t.player.y=E,t.player.dir=0,t.player.axisH=!1,t.player.drawing=!1,t.player.fastMode=!1,t.player.fillComplete=!1,t.trailBuffer=[],t.trailCursor={x:0,y:0,active:!1,bufferIndex:0},de(),ye(),te()}function de(){const e=[],r=Math.min(t.level,15),i=ge[r];for(let n=0;n<8;n++){const o=(G()&3)*2+1,s=128>>n;if((i&s)!==0){const l=Ae[n],f=l.x+(G()&7),c=l.y+(G()&7)*2;e.push({x:f,y:c,dir:o,active:!0})}else e.push({x:0,y:0,dir:o,active:!1})}t.sparks=e}function ye(){const e=Math.min(t.level,15),r=Ee[e],i=[];for(let n=0;n<2;n++){const o=128>>n;if((r&o)!==0){const a=Te[n];i.push({x:a.x,y:a.y,dir:a.dir,active:!0,wallSide:0})}else i.push({x:0,y:0,dir:0,active:!1,wallSide:0})}t.chasers=i}function Pe(){let e=0;return t.keys.fire&&(e|=1),t.keys.down&&(e|=2),t.keys.up&&(e|=4),t.keys.right&&(e|=8),t.keys.left&&(e|=16),e}function ke(){document.addEventListener("keydown",e=>{switch(e.key){case"ArrowUp":t.keys.up=!0,e.preventDefault();break;case"ArrowDown":t.keys.down=!0,e.preventDefault();break;case"ArrowLeft":t.keys.left=!0,e.preventDefault();break;case"ArrowRight":t.keys.right=!0,e.preventDefault();break;case" ":t.keys.fire=!0,e.preventDefault();break;case"p":case"P":t.paused=!t.paused;break;case"Enter":t.gameOver&&re();break}}),document.addEventListener("keyup",e=>{switch(e.key){case"ArrowUp":t.keys.up=!1;break;case"ArrowDown":t.keys.down=!1;break;case"ArrowLeft":t.keys.left=!1;break;case"ArrowRight":t.keys.right=!1;break;case" ":t.keys.fire=!1;break}})}const R=new Map;function He(){const e=window.scaleCanvas;e&&e()}function Ne(e,r){e.addEventListener("touchstart",n=>{n.preventDefault();for(let o=0;o<n.changedTouches.length;o++)R.set(n.changedTouches[o].identifier,r);t.keys[r]=!0,e.classList.add("active")},{passive:!1});const i=n=>{n.preventDefault();for(let s=0;s<n.changedTouches.length;s++)R.delete(n.changedTouches[s].identifier);let o=!1;for(const s of R.values())if(s===r){o=!0;break}o||(t.keys[r]=!1,e.classList.remove("active"))};e.addEventListener("touchend",i,{passive:!1}),e.addEventListener("touchcancel",i,{passive:!1})}function Ue(e){e.addEventListener("touchstart",i=>{i.preventDefault();for(let n=0;n<i.changedTouches.length;n++)R.set(i.changedTouches[n].identifier,"fire");t.keys.fire=!0,e.classList.add("active")},{passive:!1});const r=i=>{i.preventDefault();for(let o=0;o<i.changedTouches.length;o++)R.delete(i.changedTouches[o].identifier);let n=!1;for(const o of R.values())if(o==="fire"){n=!0;break}n||(t.keys.fire=!1,e.classList.remove("active"))};e.addEventListener("touchend",r,{passive:!1}),e.addEventListener("touchcancel",r,{passive:!1})}function Xe(){let e=!1;const r=()=>{e||(e=!0,document.body.classList.add("has-touch"),requestAnimationFrame(He))};window.addEventListener("touchstart",r,{once:!0}),document.querySelectorAll(".dpad-btn[data-dir]").forEach(a=>{const l=a.dataset.dir;Ne(a,l)});const n=document.getElementById("btn-fire");n&&Ue(n);const o=document.getElementById("btn-pause");o&&o.addEventListener("touchstart",a=>{a.preventDefault(),t.paused=!t.paused},{passive:!1});const s=document.getElementById("btn-restart");s&&s.addEventListener("touchstart",a=>{a.preventDefault(),t.gameOver&&re()},{passive:!1})}function Ve(e,r,i){const n=e&24;if(n===0||n===24)return null;let o=r,s=0;return e&16&&(o=r-1,s=4),e&8&&(o=r+1,s=0),o<g&&(o=g),o>L&&(o=L),o===r?null:{x:o,y:i,dir:s}}function Ye(e,r,i){const n=e&6;if(n===0||n===6)return null;let o=i,s=0;return e&4&&(o=i-1,s=6),e&2&&(o=i+1,s=2),o<E&&(o=E),o>F&&(o=F),o===i?null:{x:r,y:o,dir:s}}function ne(e,r){const i={moved:!1,startDraw:!1,endDraw:!1};if(!e)return i;const n=v(e.x,e.y);return t.player.drawing?n===m?(t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,t.player.axisH=e.dir===0||e.dir===4,_(e.x,e.y,T),t.trailBuffer.push({x:e.x,y:e.y,dir:e.dir}),i.moved=!0,i):(n===p&&(t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,t.player.drawing=!1,t.player.fillComplete=!0,i.moved=!0,i.endDraw=!0),i):n===p?(t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,t.player.axisH=e.dir===0||e.dir===4,i.moved=!0,i):(n===m&&t.keys.fire&&(t.player.drawing=!0,t.player.fastMode=!0,t.player.axisH=e.dir===0||e.dir===4,t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,_(e.x,e.y,T),t.trailBuffer.push({x:e.x,y:e.y,dir:e.dir}),t.trailFrameCounter=1,i.moved=!0,i.startDraw=!0),i)}function Ge(){const e=Pe();if(t.player.drawing&&(e&1||(t.player.fastMode=!1),t.player.fastMode&&t.frameCounter&1)){t.trailFrameCounter++,oe();return}const r=Ve(e,t.player.x,t.player.y),i=Ye(e,t.player.x,t.player.y);let n,o;t.player.drawing?t.player.axisH?(n=r,o=i):(n=i,o=r):t.player.axisH?(n=i,o=r):(n=r,o=i);let s=ne(n);s.moved||(s=ne(o)),t.player.drawing&&(t.trailFrameCounter++,oe())}function oe(){t.trailFrameCounter>=xe&&!t.trailCursor.active&&t.trailBuffer.length>0&&(t.trailCursor.active=!0,t.trailCursor.bufferIndex=0,t.trailCursor.x=t.trailBuffer[0].x,t.trailCursor.y=t.trailBuffer[0].y)}function Ke(){if(t.trailBuffer.length===0)return;for(const n of t.trailBuffer)_(n.x,n.y,p);const e=t.trailBuffer[0].dir,r=t.player.dir;let i=e!==r;if(!i){for(let n=1;n<t.trailBuffer.length;n++)if(t.trailBuffer[n].dir!==e){i=!0;break}}if(i){let n=0,o=t.trailBuffer[0].dir;for(let l=1;l<t.trailBuffer.length;l++){let f=t.trailBuffer[l].dir-o;f===6?f=-2:f===-6&&(f=2),n+=f,o=t.trailBuffer[l].dir}let s=r-o;s===6?s=-2:s===-6&&(s=2),n+=s;const a=n>=0?2:-2;for(const l of t.trailBuffer){const f=l.dir+a&7,c=l.x+O[f],d=l.y+S[f];v(c,d)===m&&K(c,d,B)}}else if(e===2||e===6){const s=t.trailBuffer[0].x<63?-1:1;for(const a of t.trailBuffer)if(a.dir===e){const l=a.x+s,f=a.y;v(l,f)===m&&K(l,f,B)}}else{const s=t.trailBuffer[0].y<55?-1:1;for(const a of t.trailBuffer)if(a.dir===e){const l=a.x,f=a.y+s;v(l,f)===m&&K(l,f,B)}}t.trailBuffer=[],t.trailFrameCounter=0,t.trailCursor={x:0,y:0,active:!1,bufferIndex:0},te()}function K(e,r,i){if(v(e,r)!==m)return;const n=[[e,r]];for(_(e,r,i);n.length>0;){const[o,s]=n.pop(),a=[[o-1,s],[o+1,s],[o,s-1],[o,s+1]];for(const[l,f]of a)v(l,f)===m&&(_(l,f,i),n.push([l,f]))}}function We(){const e=t.player.x,r=t.player.y;for(const i of t.chasers)if(i.active&&Math.abs(r-i.y)<N&&Math.abs(e-i.x)<N)return!0;return!!(t.trailCursor.active&&Math.abs(r-t.trailCursor.y)<N&&Math.abs(e-t.trailCursor.x)<N)}function qe(){for(const e of t.sparks)if(e.active&&v(e.x,e.y)===T)return!0;for(const e of t.chasers)if(e.active&&v(e.x,e.y)===T)return!0;return!1}function Ze(e){if(!e.active)return;const r=e.dir+6&7,i=e.dir,n=e.dir+2&7,o=v(e.x+O[r],e.y+S[r]),s=v(e.x+O[i],e.y+S[i]),a=v(e.x+O[n],e.y+S[n]),l=o===T?m:o,f=s===T?m:s,c=a===T?m:a;l!==p&&(c===m?e.wallSide=0:c!==p&&(e.wallSide=1));let d;e.wallSide===0?c===p?d=2:f===p?d=0:l===p?d=-2:d=-4:l===p?d=-2:f===p?d=0:c===p?d=2:d=-4,e.dir=e.dir+d+8&7,e.x+=O[e.dir],e.y+=S[e.dir]}function ze(e){if(!e.active)return;const r=v(e.x,e.y);if(r===B){W(e);return}if(r===T){t.collision=!0,W(e);return}const i=e.x+O[e.dir],n=e.y+S[e.dir],o=v(i,n);if(o===m||o===T){e.x=i,e.y=n;return}if(o===p){const s=e.dir+2&7,a=e.x+O[s],l=e.y+S[s];if(v(a,l)===m){e.dir=s,e.x=a,e.y=l;return}const f=e.dir+6&7,c=e.x+O[f],d=e.y+S[f];if(v(c,d)===m){e.dir=f,e.x=c,e.y=d;return}const y=e.dir+4&7,u=e.x+O[y],h=e.y+S[y];if(v(u,h)===m){e.dir=y,e.x=u,e.y=h;return}return}W(e)}function W(e){e.active=!1,e.x=0,e.y=0,t.score+=Ce}function je(){if(!t.trailCursor.active)return;const e=t.trailCursor.bufferIndex+2;if(e>=t.trailBuffer.length){t.collision=!0;return}t.trailCursor.bufferIndex=e;const r=t.trailBuffer[e];t.trailCursor.x=r.x,t.trailCursor.y=r.y}function se(){for(const e of t.trailBuffer)v(e.x,e.y)===T&&_(e.x,e.y,m);if(t.trailBuffer=[],t.trailFrameCounter=0,t.trailCursor={x:0,y:0,active:!1,bufferIndex:0},t.player.drawing=!1,t.player.fillComplete=!1,t.lives--,t.lives<=0){t.gameOver=!0,t.gameOverFrame=0;return}t.player.x=g,t.player.y=E,t.player.dir=0,t.player.axisH=!1,ye(),de(),t.collision=!1,t.timerExpired=!1,t.deathAnimTimer=30}function Je(){t.score+=(t.rawPercentage+t.percentage)*4,t.rawPercentage=0,t.percentage=0,t.lcAnim.active=!0,t.lcAnim.phase=0,t.lcAnim.frame=0,t.lcAnim.timerCountdown=t.timer,t.lcAnim.subFrame=0}function Qe(){const e=t.lcAnim;switch(e.frame++,e.phase){case 0:e.frame>=32&&(e.phase=1,e.frame=0,e.subFrame=0);break;case 1:if(e.timerCountdown<=0){e.phase=2,e.frame=0;break}e.subFrame++,e.subFrame>=2&&(e.subFrame=0,e.timerCountdown--,t.timer--,t.score++);break;case 2:e.frame>=50&&(e.phase=3);break;case 3:e.active=!1,t.levelComplete=!1,t.level++,ue();break}}function $e(){if(!t.paused){if(t.gameOver){t.gameOverFrame++;return}if(t.lcAnim.active){Qe();return}if(t.deathAnimTimer>0){t.deathAnimTimer--;return}t.frameCounter++,Ge(),t.player.fillComplete&&(t.player.fillComplete=!1,Ke()),t.player.drawing&&qe()&&(t.collision=!0);for(const e of t.chasers)Ze(e);for(const e of t.sparks)ze(e);if(je(),We()&&(t.collision=!0),t.timerSub--,t.timerSub===0&&(t.timerSub=Q,t.timer--,t.timer<=0&&(t.timer=0,t.timerExpired=!0)),te(),t.timerExpired){t.gameOverOutOfTime=!0,se(),t.timerExpired=!1;return}if(t.collision){t.gameOverOutOfTime=!1,se(),t.collision=!1;return}if(t.levelComplete){Je();return}}}function C(e,r,i){e>=0&&e<I&&r>=0&&r<H&&(ee[r*I+e]=i)}function A(e,r,i,n,o){for(let s=r;s<r+n;s++)for(let a=e;a<e+i;a++)C(a,s,o)}function me(e,r,i){e>=0&&e<w&&r>=0&&r<P&&(k[r*w+e]=i)}function D(e,r,i){return 64|(r&7)<<3|i&7}function b(e,r,i,n){for(let o=0;o<i;o++)me(r+o,e,n)}function V(e,r){b(e,0,w,r)}const et=new Uint8Array([0,0,0,0,0,0,0,0,96,96,96,96,96,0,96,0,108,108,108,0,0,0,0,0,54,54,127,54,127,54,54,0,24,62,88,60,26,124,24,0,0,99,102,12,24,51,99,0,28,54,28,59,110,102,59,0,48,48,96,0,0,0,0,0,24,48,96,96,96,48,24,0,96,48,24,24,24,48,96,0,0,54,28,127,28,54,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,48,48,96,0,0,0,126,0,0,0,0,0,0,0,0,0,96,96,0,3,6,12,24,48,96,64,0,62,99,103,107,115,99,62,0,48,112,48,48,48,48,120,0,60,102,6,60,96,96,126,0,60,102,6,28,6,102,60,0,14,30,54,102,127,6,6,0,126,96,96,124,6,102,60,0,60,102,96,124,102,102,60,0,126,6,6,12,24,24,24,0,60,102,102,60,102,102,60,0,60,102,102,62,6,102,60,0,0,0,96,96,0,96,96,0,0,0,48,48,0,48,48,96,12,24,48,96,48,24,12,0,0,0,126,0,0,126,0,0,96,48,24,12,24,48,96,0,60,102,102,12,24,0,24,0,62,99,111,111,111,96,62,0,60,102,102,126,102,102,102,0,124,102,102,124,102,102,124,0,60,102,96,96,96,102,60,0,124,102,102,102,102,102,124,0,126,96,96,124,96,96,126,0,126,96,96,124,96,96,96,0,60,102,96,96,110,102,60,0,102,102,102,126,102,102,102,0,120,48,48,48,48,48,120,0,6,6,6,6,102,102,60,0,102,102,108,120,108,102,102,0,96,96,96,96,96,96,126,0,99,119,127,127,107,99,99,0,99,115,123,111,103,99,99,0,28,54,99,99,99,54,28,0,124,102,102,124,96,96,96,0,28,54,99,99,109,54,27,0,124,102,102,124,108,102,102,0,60,102,96,60,6,102,60,0,126,24,24,24,24,24,24,0,102,102,102,102,102,102,60,0,102,102,102,102,102,60,24,0,99,99,99,107,127,119,99,0,99,54,28,28,54,99,99,0,102,102,102,60,24,24,24,0,127,3,6,12,24,48,127,0,0,0,2,4,8,80,32,0,0,66,36,24,24,36,66,0,12,28,60,124,60,28,12,0,24,60,126,24,24,24,24,0,0,0,0,0,0,0,0,127,96,112,120,124,120,112,96,0,0,0,60,6,62,102,62,0,96,96,124,102,102,102,124,0,0,0,60,102,96,102,60,0,6,6,62,102,102,102,62,0,0,0,60,102,126,96,60,0,56,108,96,120,96,96,96,0,0,0,62,102,102,62,6,124,96,96,108,118,102,102,102,0,96,0,96,96,96,96,96,0,6,0,6,6,6,102,102,60,96,96,102,108,120,108,102,0,96,96,96,96,96,96,96,0,0,0,54,127,107,107,99,0,0,0,124,102,102,102,102,0,0,0,60,102,102,102,60,0,0,0,124,102,102,124,96,96,0,0,62,102,102,62,7,6,0,0,60,102,96,96,96,0,0,0,60,96,60,6,124,0,48,48,124,48,48,54,28,0,0,0,102,102,102,102,62,0,0,0,102,102,102,60,24,0,0,0,99,107,107,127,54,0,0,0,99,54,28,54,99,0,0,0,102,102,102,62,6,124,0,0,126,12,24,48,126,0,24,24,24,24,126,60,24,0,0,0,0,24,24,0,0,0,28,34,73,81,73,34,28,0,0,0,0,0,0,0,0,0,127,127,127,127,127,127,127,0]),tt=new Uint8Array([60,102,102,102,102,102,60,0,24,56,24,24,24,24,126,0,60,102,6,60,96,96,126,0,60,102,6,28,6,102,60,0,14,30,54,102,127,6,6,0,126,96,96,124,6,102,60,0,60,102,96,124,102,102,60,0,126,6,6,12,24,24,24,0,60,102,102,60,102,102,60,0,60,102,102,62,6,102,60,0,0,0,0,0,0,0,0,0,0,99,102,12,24,51,99,0,60,102,96,60,6,102,60,0,0,0,60,102,96,102,60,0,0,0,60,102,102,102,60,0,0,0,60,102,96,96,96,0,0,0,60,102,126,96,60,0,96,96,96,96,96,96,126,0,0,0,102,102,102,60,24,0,48,48,48,48,48,48,48,0,24,0,56,24,24,24,60,0,0,0,62,96,60,6,124,0,255,24,24,24,24,24,24,0,0,0,108,254,214,214,198,0,0,13,17,9,5,5,25,0,0,140,80,80,144,16,12,0,0,25,21,21,21,21,25,0,0,208,16,144,16,16,220,0,0,6,9,9,9,9,6,0,0,72,80,96,80,72,72,0,60,66,129,129,129,129,66,60,60,66,153,189,189,153,66,60]),rt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9," ":10,"%":11,S:12,c:13,o:14,r:15,e:16,L:17,v:18,l:19,i:20,s:21,T:22,m:23};function it(e,r,i){const n=e.charCodeAt(0);if(n<32||n>127)return;const o=(n-32)*8;for(let s=0;s<8;s++){const a=et[o+s];for(let l=0;l<8;l++)a&128>>l&&C(r+l,i+s,1)}}function M(e,r,i){const n=i.toUpperCase();for(let o=0;o<n.length;o++)it(n[o],(r+o)*8,e*8)}function nt(e,r,i){const n=rt[e];if(n===void 0)return;const o=n*8;for(let s=0;s<8;s++){const a=tt[o+s];for(let l=0;l<8;l++)a&128>>l&&(C(r+l,i+s*2,1),C(r+l,i+s*2+1,1))}}function q(e,r,i){for(let n=0;n<i.length;n++)nt(i[n],(r+n)*8,e*8)}function le(e,r){const i=Math.floor((w-r.length)/2);return M(e,i,r),i}const ot=[255,195,129,129,129,129,195,255],st=[0,60,66,66,66,66,60,0],lt=[0,60,114,122,126,126,60,0],at=[0,60,106,86,106,86,60,0];function Z(e,r,i){const n=e*2-3,o=r*2-3;for(let s=0;s<8;s++){const a=ot[s],l=i[s];for(let f=0;f<8;f++){const c=7-f;a>>c&1||C(n+f,o+s,l>>c&1)}}}function ft(e,r){const i=e*2,n=r*2;C(i,n,1),C(i+1,n,1),C(i,n+1,1),C(i+1,n+1,1)}const ct=[[0,0,0],[0,0,255],[255,0,0],[255,0,255],[0,255,0],[0,255,255],[255,255,0],[255,255,255]],ut=[[0,0,0],[0,0,208],[208,0,0],[208,0,208],[0,208,0],[0,208,208],[208,208,0],[208,208,208]];function dt(){const e=Ie(),r=Fe(),i=e.data;for(let n=0;n<H;n++){const o=n>>3,s=n*I,a=o*w;for(let l=0;l<I;l++){const f=k[a+(l>>3)],c=f>>6&1,d=f>>3&7,y=f&7,u=c?ct:ut,h=ee[s+l]?u[y]:u[d],x=s+l<<2;i[x]=h[0],i[x+1]=h[1],i[x+2]=h[2],i[x+3]=255}}r.putImageData(e,0,0)}function yt(){for(let e=E;e<=F;e++)for(let r=g;r<=L;r++){const i=t.grid[e][r];if(i===m)continue;const n=r*2,o=e*2,s=Oe[i];C(n,o,s[0]>>7-(n&7)&1),C(n+1,o,s[0]>>7-(n+1&7)&1),C(n,o+1,s[1]>>7-(n&7)&1),C(n+1,o+1,s[1]>>7-(n+1&7)&1)}}function mt(){for(const e of t.sparks)e.active&&ft(e.x,e.y);t.trailCursor.active&&Z(t.trailCursor.x,t.trailCursor.y,at);for(const e of t.chasers)e.active&&Z(e.x,e.y,lt);t.deathAnimTimer<=0&&Z(t.player.x,t.player.y,st)}function pt(){const e=De().toString().padStart(5,"0"),r=(t.level+1).toString().padStart(2,"0"),i=t.lives.toString(),n="Score "+e+"   Level "+r+"   Lives "+i;q(0,0,n);const o=D(!0,0,5);V(0,o),V(1,o),q(2,0,"Time");const s=40,a=17,l=13,f=t.timer;f>0&&A(s,a,f,l,1);const c=t.percentage.toString().padStart(3,"0")+"%";q(2,28,c);const d=t.timer>=40?D(!0,0,4):D(!0,0,2);for(let y=2;y<=3;y++)b(y,0,5,o),b(y,5,22,d),me(27,y,o),b(y,28,4,D(!0,0,7))}function vt(){ee.fill(0),k.fill(0);const e=$[t.level&15];for(let i=4;i<P;i++)V(i,e);yt(),mt(),pt();const r=D(!0,0,Me());if(t.gameOver){for(let u=4;u<P;u++)for(let h=0;h<w;h++){const x=u*w+h;k[x]&=-65}const i=11,n=8,o=16,s=t.gameOverOutOfTime?7:5,a=n*8,l=i*8,f=o*8,c=s*8;A(a,l,f,c,0),A(a,l,f,1,1),A(a,l+c-1,f,1,1),A(a,l,1,c,1),A(a+f-1,l,1,c,1);const d=[112,120,64,72,80,88,96,104];let y;if(t.gameOverFrame<32){const u=Math.floor(t.gameOverFrame/2)&7;y=d[u]}else y=104;for(let u=i;u<i+s;u++)b(u,n,o,y);if(t.gameOverOutOfTime){const u="OUT OF TIME";M(13,Math.floor(n+(o-u.length)/2),u);const h="GAME OVER";M(15,Math.floor(n+(o-h.length)/2),h)}else{const u="GAME OVER";M(13,Math.floor(n+(o-u.length)/2),u)}}if(t.lcAnim.active){for(let x=4;x<P;x++)for(let Y=0;Y<w;Y++)k[x*w+Y]&=-65;const i=11,n=7,o=18,s=5,a=n*8,l=i*8,f=o*8,c=s*8;A(a,l,f,c,0),A(a,l,f,1,1),A(a,l+c-1,f,1,1),A(a,l,1,c,1),A(a+f-1,l,1,c,1);const d=[112,120,64,72,80,88,96,104],y=t.lcAnim;let u;y.phase===0&&y.frame<32?u=d[Math.floor(y.frame/2)&7]:u=104;for(let x=i;x<i+s;x++)b(x,n,o,u);const h="SCREEN COMPLETED";M(13,Math.floor(n+(o-h.length)/2),h)}if(t.paused&&!t.gameOver&&!t.lcAnim.active){for(let n=11;n<13;n++)V(n,r);A(0,88,I,16,0),le(11,"PAUSED");const i=document.body.classList.contains("has-touch");le(12,i?"TAP PAUSE":"P TO RESUME")}dt()}const ae=1e3/Se;let J=0,z=0;function pe(e){const r=e-J;for(J=e,z+=r;z>=ae;)$e(),z-=ae;vt(),requestAnimationFrame(pe)}Le();ke();Xe();re();requestAnimationFrame(e=>{J=e,pe(e)});</script>
</head>
<body>
<canvas id="game"></canvas>
<div id="info">
  <b>Arrows</b> = Move &nbsp; <b>Space</b> = Fire (start drawing / slow mode while drawing)<br>
  Claim <b>75%</b> of the field to complete a level. Avoid chasers, sparks, and the trail cursor!
</div>
<div id="touch-controls">
  <div id="dpad">
    <button class="dpad-btn" data-dir="up">&#9650;</button>
    <div class="dpad-mid">
      <button class="dpad-btn" data-dir="left">&#9664;</button>
      <div class="dpad-center"></div>
      <button class="dpad-btn" data-dir="right">&#9654;</button>
    </div>
    <button class="dpad-btn" data-dir="down">&#9660;</button>
  </div>
  <div id="action-buttons">
    <button id="btn-fire">FIRE</button>
    <div id="aux-buttons">
      <button id="btn-pause">&#10074;&#10074;</button>
      <button id="btn-restart">&#8634;</button>
    </div>
  </div>
</div>
<script>
  var NATIVE_W = 256;
  var NATIVE_H = 192;
  var PADDING = 40;
  var INFO_GAP = 12;
  var INFO_FALLBACK_H = 60;
  var MIN_SCALE = 1;

  function scaleCanvas() {
    var c = document.getElementById("game");
    var touchCtrl = document.getElementById("touch-controls");
    var info = document.getElementById("info");
    var isTouchVisible = touchCtrl && getComputedStyle(touchCtrl).display !== "none";
    var belowH = isTouchVisible
      ? touchCtrl.offsetHeight + INFO_GAP
      : (info ? info.offsetHeight + INFO_GAP : INFO_FALLBACK_H);
    var s = Math.max(MIN_SCALE, Math.min(
      Math.floor((window.innerWidth - PADDING) / NATIVE_W),
      Math.floor((window.innerHeight - belowH - PADDING) / NATIVE_H)
    ));
    c.style.width = (NATIVE_W * s) + "px";
    c.style.height = (NATIVE_H * s) + "px";
  }
  scaleCanvas();
  window.addEventListener("resize", scaleCanvas);
</script>
</body>
</html>
