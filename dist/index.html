<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zolyx</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: monospace;
    color: #d7d700;
  }
  canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }
  #info {
    color: #aaa;
    font-size: 13px;
    margin-top: 12px;
    text-align: center;
    line-height: 1.6;
  }
  #info b { color: #fff; }
</style>
  <script type="module" crossorigin>(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();const h=2,R=125,g=18,T=93,m=0,D=1,E=2,p=3,O=[1,1,0,-1,-1,-1,0,1],F=[0,1,1,1,0,-1,-1,-1],pe=396,te=90,xe=75,ae=3,se=176,J=14,ve=72,Ce=50,N=2,Ae=[{x:29,y:33},{x:61,y:33},{x:93,y:33},{x:29,y:53},{x:93,y:53},{x:29,y:73},{x:61,y:73},{x:93,y:73}],we=[64,24,162,90,186,189,253,255,255,255,255,255,255,255,255,255],he=[128,128,128,128,128,128,192,192,192,192,192,192,192,192,192,192],Q=[112,104,88,96,104,120,104,112,96,88,120,104,112,80,88,104],ge=["#000000","#0000FF","#FF0000","#FF00FF","#00FF00","#00FFFF","#FFFF00","#FFFFFF"],Se=[{x:64,y:18,dir:0},{x:64,y:93,dir:4}],b=256,k=192,S=32,B=24,Ee=[[0,0],[85,0],[170,85],[255,255]],Oe=50,$=new Uint8Array(b*k),P=new Uint8Array(S*B);let H=null,X=null,z=null;function Fe(){H=document.getElementById("game"),H.width=b,H.height=k,X=H.getContext("2d"),z=X.createImageData(b,k)}function Re(){if(!X)throw new Error("Screen not initialized — call initScreen() first");return X}function Te(){if(!z)throw new Error("Screen not initialized — call initScreen() first");return z}const t={grid:[],player:{x:h,y:g,dir:0,axisH:!1,drawing:!1,fastMode:!1,fillComplete:!1,drawStartX:0,drawStartY:0},trailBuffer:[],trailFrameCounter:0,chasers:[],sparks:[],trailCursor:{x:0,y:0,active:!1,bufferIndex:0},score:0,lives:ae,level:0,timer:se,timerSub:J,frameCounter:0,percentage:0,rawPercentage:0,fieldColor:"#FFFF00",gameOver:!1,gameOverOutOfTime:!1,gameOverFrame:0,levelComplete:!1,lcAnim:{active:!1,phase:0,frame:0,timerCountdown:0,subFrame:0},collision:!1,timerExpired:!1,paused:!1,deathAnimTimer:0,keys:{up:!1,down:!1,left:!1,right:!1,fire:!1}};function be(){const e=[];for(let r=0;r<128;r++){e[r]=[];for(let i=0;i<128;i++)e[r][i]=m}for(let r=h;r<=R;r++)e[g][r]=p;for(let r=h;r<=R;r++)e[T][r]=p;for(let r=g;r<=T;r++)e[r][h]=p;for(let r=g;r<=T;r++)e[r][R]=p;t.grid=e}function x(e,r){return e<0||e>=128||r<0||r>=128?p:t.grid[r][e]}function L(e,r,i){e>=0&&e<128&&r>=0&&r<128&&(t.grid[r][e]=i)}function Ie(){let e=0;for(let r=g;r<=T;r++)for(let i=h;i<=R;i++)t.grid[r][i]!==m&&e++;return e}function Le(){let e=0;for(let r=g;r<=T;r++)for(let i=h;i<=R;i++)t.grid[r][i]===D&&e++;return e}function ee(){const e=Le();t.rawPercentage=Math.floor(e/te);const r=Ie();t.percentage=Math.floor((r-pe)/te),t.percentage>=xe&&(t.levelComplete=!0)}function _e(){return t.score+(t.rawPercentage+t.percentage)*4}function Me(){return Q[t.level&15]>>3&7}function V(){return Math.floor(Math.random()*256)}function De(e){const i=Q[e&15]>>3&7;return ge[i]}function fe(){t.level=0,t.score=0,t.lives=ae,t.gameOver=!1,t.gameOverOutOfTime=!1,t.gameOverFrame=0,ce()}function ce(){t.timer=se,t.timerSub=J,t.frameCounter=0,t.trailFrameCounter=0,t.levelComplete=!1,t.collision=!1,t.timerExpired=!1,t.deathAnimTimer=0,t.fieldColor=De(t.level),be(),t.player.x=h,t.player.y=g,t.player.dir=0,t.player.axisH=!1,t.player.drawing=!1,t.player.fastMode=!1,t.player.fillComplete=!1,t.player.drawStartX=0,t.player.drawStartY=0,t.trailBuffer=[],t.trailCursor={x:0,y:0,active:!1,bufferIndex:0},ue(),de(),ee()}function ue(){const e=[],r=Math.min(t.level,15),i=we[r];for(let n=0;n<8;n++){const o=(V()&3)*2+1,l=128>>n;if((i&l)!==0){const a=Ae[n],f=a.x+(V()&7),c=a.y+(V()&7)*2;e.push({x:f,y:c,dir:o,active:!0})}else e.push({x:0,y:0,dir:o,active:!1})}t.sparks=e}function de(){const e=Math.min(t.level,15),r=he[e],i=[];for(let n=0;n<2;n++){const o=128>>n;if((r&o)!==0){const s=Se[n];i.push({x:s.x,y:s.y,dir:s.dir,active:!0,wallSide:0})}else i.push({x:0,y:0,dir:0,active:!1,wallSide:0})}t.chasers=i}function Be(){let e=0;return t.keys.fire&&(e|=1),t.keys.down&&(e|=2),t.keys.up&&(e|=4),t.keys.right&&(e|=8),t.keys.left&&(e|=16),e}function Pe(){document.addEventListener("keydown",e=>{switch(e.key){case"ArrowUp":t.keys.up=!0,e.preventDefault();break;case"ArrowDown":t.keys.down=!0,e.preventDefault();break;case"ArrowLeft":t.keys.left=!0,e.preventDefault();break;case"ArrowRight":t.keys.right=!0,e.preventDefault();break;case" ":t.keys.fire=!0,e.preventDefault();break;case"p":case"P":t.paused=!t.paused;break;case"Enter":t.gameOver&&fe();break}}),document.addEventListener("keyup",e=>{switch(e.key){case"ArrowUp":t.keys.up=!1;break;case"ArrowDown":t.keys.down=!1;break;case"ArrowLeft":t.keys.left=!1;break;case"ArrowRight":t.keys.right=!1;break;case" ":t.keys.fire=!1;break}})}function ke(e,r,i){const n=e&24;if(n===0||n===24)return null;let o=r,l=0;return e&16&&(o=r-1,l=4),e&8&&(o=r+1,l=0),o<h&&(o=h),o>R&&(o=R),o===r?null:{x:o,y:i,dir:l}}function Ne(e,r,i){const n=e&6;if(n===0||n===6)return null;let o=i,l=0;return e&4&&(o=i-1,l=6),e&2&&(o=i+1,l=2),o<g&&(o=g),o>T&&(o=T),o===i?null:{x:r,y:o,dir:l}}function re(e,r){const i={moved:!1,startDraw:!1,endDraw:!1};if(!e)return i;const n=x(e.x,e.y);return t.player.drawing?n===m?(t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,t.player.axisH=e.dir===0||e.dir===4,L(e.x,e.y,E),t.trailBuffer.push({x:e.x,y:e.y,dir:e.dir}),i.moved=!0,i):(n===p&&(t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,t.player.drawing=!1,t.player.fillComplete=!0,i.moved=!0,i.endDraw=!0),i):n===p?(t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,t.player.axisH=e.dir===0||e.dir===4,i.moved=!0,i):(n===m&&t.keys.fire&&(t.player.drawStartX=t.player.x,t.player.drawStartY=t.player.y,t.player.drawing=!0,t.player.fastMode=!0,t.player.axisH=e.dir===0||e.dir===4,t.player.x=e.x,t.player.y=e.y,t.player.dir=e.dir,L(e.x,e.y,E),t.trailBuffer.push({x:e.x,y:e.y,dir:e.dir}),t.trailFrameCounter=1,i.moved=!0,i.startDraw=!0),i)}function He(){const e=Be();if(t.player.drawing&&(e&1||(t.player.fastMode=!1),t.player.fastMode&&t.frameCounter&1)){t.trailFrameCounter++,ie();return}const r=ke(e,t.player.x,t.player.y),i=Ne(e,t.player.x,t.player.y);let n,o;t.player.drawing?t.player.axisH?(n=r,o=i):(n=i,o=r):t.player.axisH?(n=i,o=r):(n=r,o=i);let l=re(n);l.moved||(l=re(o)),t.player.drawing&&(t.trailFrameCounter++,ie())}function ie(){t.trailFrameCounter>=ve&&!t.trailCursor.active&&t.trailBuffer.length>0&&(t.trailCursor.active=!0,t.trailCursor.bufferIndex=0,t.trailCursor.x=t.trailBuffer[0].x,t.trailCursor.y=t.trailBuffer[0].y)}function Xe(){if(t.trailBuffer.length===0)return;for(const n of t.trailBuffer)L(n.x,n.y,p);const e=t.trailBuffer[0].dir,r=t.player.dir;let i=e!==r;if(!i){for(let n=1;n<t.trailBuffer.length;n++)if(t.trailBuffer[n].dir!==e){i=!0;break}}if(i){let n=0,o=t.trailBuffer[0].dir;for(let a=1;a<t.trailBuffer.length;a++){let f=t.trailBuffer[a].dir-o;f===6?f=-2:f===-6&&(f=2),n+=f,o=t.trailBuffer[a].dir}let l=r-o;l===6?l=-2:l===-6&&(l=2),n+=l;const s=n>=0?2:-2;for(const a of t.trailBuffer){const f=a.dir+s&7,c=a.x+O[f],d=a.y+F[f];x(c,d)===m&&G(c,d,D)}}else if(e===2||e===6){const l=t.trailBuffer[0].x<63?-1:1;for(const s of t.trailBuffer)if(s.dir===e){const a=s.x+l,f=s.y;x(a,f)===m&&G(a,f,D)}}else{const l=t.trailBuffer[0].y<55?-1:1;for(const s of t.trailBuffer)if(s.dir===e){const a=s.x,f=s.y+l;x(a,f)===m&&G(a,f,D)}}t.trailBuffer=[],t.trailFrameCounter=0,t.trailCursor={x:0,y:0,active:!1,bufferIndex:0},ee()}function G(e,r,i){if(x(e,r)!==m)return;const n=[[e,r]];for(L(e,r,i);n.length>0;){const[o,l]=n.pop(),s=[[o-1,l],[o+1,l],[o,l-1],[o,l+1]];for(const[a,f]of s)x(a,f)===m&&(L(a,f,i),n.push([a,f]))}}function Ue(){const e=t.player.x,r=t.player.y;for(const i of t.chasers)if(i.active&&Math.abs(r-i.y)<N&&Math.abs(e-i.x)<N)return!0;return!!(t.trailCursor.active&&Math.abs(r-t.trailCursor.y)<N&&Math.abs(e-t.trailCursor.x)<N)}function Ye(){for(const e of t.sparks)if(e.active&&x(e.x,e.y)===E)return!0;for(const e of t.chasers)if(e.active&&x(e.x,e.y)===E)return!0;return!1}function Ve(e){if(!e.active)return;const r=e.dir+6&7,i=e.dir,n=e.dir+2&7,o=x(e.x+O[r],e.y+F[r]),l=x(e.x+O[i],e.y+F[i]),s=x(e.x+O[n],e.y+F[n]),a=o===E?m:o,f=l===E?m:l,c=s===E?m:s;a!==p&&(c===m?e.wallSide=0:c!==p&&(e.wallSide=1));let d;e.wallSide===0?c===p?d=2:f===p?d=0:a===p?d=-2:d=-4:a===p?d=-2:f===p?d=0:c===p?d=2:d=-4,e.dir=e.dir+d+8&7,e.x+=O[e.dir],e.y+=F[e.dir]}function Ge(e){if(!e.active)return;const r=x(e.x,e.y);if(r===D){K(e);return}if(r===E){t.collision=!0,K(e);return}const i=e.x+O[e.dir],n=e.y+F[e.dir],o=x(i,n);if(o===m||o===E){e.x=i,e.y=n;return}if(o===p){const l=e.dir+2&7,s=e.x+O[l],a=e.y+F[l];if(x(s,a)===m){e.dir=l,e.x=s,e.y=a;return}const f=e.dir+6&7,c=e.x+O[f],d=e.y+F[f];if(x(c,d)===m){e.dir=f,e.x=c,e.y=d;return}const y=e.dir+4&7,u=e.x+O[y],v=e.y+F[y];if(x(u,v)===m){e.dir=y,e.x=u,e.y=v;return}return}K(e)}function K(e){e.active=!1,e.x=0,e.y=0,t.score+=Ce}function Ke(){if(!t.trailCursor.active)return;const e=t.trailCursor.bufferIndex+2;if(e>=t.trailBuffer.length){t.collision=!0;return}t.trailCursor.bufferIndex=e;const r=t.trailBuffer[e];t.trailCursor.x=r.x,t.trailCursor.y=r.y}function ne(){for(const e of t.trailBuffer)x(e.x,e.y)===E&&L(e.x,e.y,m);if(t.trailBuffer=[],t.trailFrameCounter=0,t.trailCursor={x:0,y:0,active:!1,bufferIndex:0},t.player.drawing=!1,t.player.fillComplete=!1,t.lives--,t.lives<=0){t.gameOver=!0,t.gameOverFrame=0;return}t.player.x=h,t.player.y=g,t.player.dir=0,t.player.axisH=!1,de(),ue(),t.collision=!1,t.timerExpired=!1,t.deathAnimTimer=30}function We(){t.score+=(t.rawPercentage+t.percentage)*4,t.rawPercentage=0,t.percentage=0,t.lcAnim.active=!0,t.lcAnim.phase=0,t.lcAnim.frame=0,t.lcAnim.timerCountdown=t.timer,t.lcAnim.subFrame=0}function Ze(){const e=t.lcAnim;switch(e.frame++,e.phase){case 0:e.frame>=32&&(e.phase=1,e.frame=0,e.subFrame=0);break;case 1:if(e.timerCountdown<=0){e.phase=2,e.frame=0;break}e.subFrame++,e.subFrame>=2&&(e.subFrame=0,e.timerCountdown--,t.timer--,t.score++);break;case 2:e.frame>=50&&(e.phase=3);break;case 3:e.active=!1,t.levelComplete=!1,t.level++,ce();break}}function qe(){if(!t.paused){if(t.gameOver){t.gameOverFrame++;return}if(t.lcAnim.active){Ze();return}if(t.deathAnimTimer>0){t.deathAnimTimer--;return}t.frameCounter++,He(),t.player.fillComplete&&(t.player.fillComplete=!1,Xe()),t.player.drawing&&Ye()&&(t.collision=!0);for(const e of t.chasers)Ve(e);for(const e of t.sparks)Ge(e);if(Ke(),Ue()&&(t.collision=!0),t.timerSub--,t.timerSub<=0&&(t.timerSub=J,t.timer--,t.timer<=0&&(t.timer=0,t.timerExpired=!0)),ee(),t.timerExpired){t.gameOverOutOfTime=!0,ne(),t.timerExpired=!1;return}if(t.collision){t.gameOverOutOfTime=!1,ne(),t.collision=!1;return}if(t.levelComplete){We();return}}}function A(e,r,i){e>=0&&e<b&&r>=0&&r<k&&($[r*b+e]=i)}function w(e,r,i,n,o){for(let l=r;l<r+n;l++)for(let s=e;s<e+i;s++)A(s,l,o)}function ye(e,r,i){e>=0&&e<S&&r>=0&&r<B&&(P[r*S+e]=i)}function _(e,r,i){return 64|(r&7)<<3|i&7}function I(e,r,i,n){for(let o=0;o<i;o++)ye(r+o,e,n)}function U(e,r){I(e,0,S,r)}const ze=new Uint8Array([0,0,0,0,0,0,0,0,96,96,96,96,96,0,96,0,108,108,108,0,0,0,0,0,54,54,127,54,127,54,54,0,24,62,88,60,26,124,24,0,0,99,102,12,24,51,99,0,28,54,28,59,110,102,59,0,48,48,96,0,0,0,0,0,24,48,96,96,96,48,24,0,96,48,24,24,24,48,96,0,0,54,28,127,28,54,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,48,48,96,0,0,0,126,0,0,0,0,0,0,0,0,0,96,96,0,3,6,12,24,48,96,64,0,62,99,103,107,115,99,62,0,48,112,48,48,48,48,120,0,60,102,6,60,96,96,126,0,60,102,6,28,6,102,60,0,14,30,54,102,127,6,6,0,126,96,96,124,6,102,60,0,60,102,96,124,102,102,60,0,126,6,6,12,24,24,24,0,60,102,102,60,102,102,60,0,60,102,102,62,6,102,60,0,0,0,96,96,0,96,96,0,0,0,48,48,0,48,48,96,12,24,48,96,48,24,12,0,0,0,126,0,0,126,0,0,96,48,24,12,24,48,96,0,60,102,102,12,24,0,24,0,62,99,111,111,111,96,62,0,60,102,102,126,102,102,102,0,124,102,102,124,102,102,124,0,60,102,96,96,96,102,60,0,124,102,102,102,102,102,124,0,126,96,96,124,96,96,126,0,126,96,96,124,96,96,96,0,60,102,96,96,110,102,60,0,102,102,102,126,102,102,102,0,120,48,48,48,48,48,120,0,6,6,6,6,102,102,60,0,102,102,108,120,108,102,102,0,96,96,96,96,96,96,126,0,99,119,127,127,107,99,99,0,99,115,123,111,103,99,99,0,28,54,99,99,99,54,28,0,124,102,102,124,96,96,96,0,28,54,99,99,109,54,27,0,124,102,102,124,108,102,102,0,60,102,96,60,6,102,60,0,126,24,24,24,24,24,24,0,102,102,102,102,102,102,60,0,102,102,102,102,102,60,24,0,99,99,99,107,127,119,99,0,99,54,28,28,54,99,99,0,102,102,102,60,24,24,24,0,127,3,6,12,24,48,127,0,0,0,2,4,8,80,32,0,0,66,36,24,24,36,66,0,12,28,60,124,60,28,12,0,24,60,126,24,24,24,24,0,0,0,0,0,0,0,0,127,96,112,120,124,120,112,96,0,0,0,60,6,62,102,62,0,96,96,124,102,102,102,124,0,0,0,60,102,96,102,60,0,6,6,62,102,102,102,62,0,0,0,60,102,126,96,60,0,56,108,96,120,96,96,96,0,0,0,62,102,102,62,6,124,96,96,108,118,102,102,102,0,96,0,96,96,96,96,96,0,6,0,6,6,6,102,102,60,96,96,102,108,120,108,102,0,96,96,96,96,96,96,96,0,0,0,54,127,107,107,99,0,0,0,124,102,102,102,102,0,0,0,60,102,102,102,60,0,0,0,124,102,102,124,96,96,0,0,62,102,102,62,7,6,0,0,60,102,96,96,96,0,0,0,60,96,60,6,124,0,48,48,124,48,48,54,28,0,0,0,102,102,102,102,62,0,0,0,102,102,102,60,24,0,0,0,99,107,107,127,54,0,0,0,99,54,28,54,99,0,0,0,102,102,102,62,6,124,0,0,126,12,24,48,126,0,24,24,24,24,126,60,24,0,0,0,0,24,24,0,0,0,28,34,73,81,73,34,28,0,0,0,0,0,0,0,0,0,127,127,127,127,127,127,127,0]),je=new Uint8Array([60,102,102,102,102,102,60,0,24,56,24,24,24,24,126,0,60,102,6,60,96,96,126,0,60,102,6,28,6,102,60,0,14,30,54,102,127,6,6,0,126,96,96,124,6,102,60,0,60,102,96,124,102,102,60,0,126,6,6,12,24,24,24,0,60,102,102,60,102,102,60,0,60,102,102,62,6,102,60,0,0,0,0,0,0,0,0,0,0,99,102,12,24,51,99,0,60,102,96,60,6,102,60,0,0,0,60,102,96,102,60,0,0,0,60,102,102,102,60,0,0,0,60,102,96,96,96,0,0,0,60,102,126,96,60,0,96,96,96,96,96,96,126,0,0,0,102,102,102,60,24,0,48,48,48,48,48,48,48,0,24,0,56,24,24,24,60,0,0,0,62,96,60,6,124,0,255,24,24,24,24,24,24,0,0,0,108,254,214,214,198,0,0,13,17,9,5,5,25,0,0,140,80,80,144,16,12,0,0,25,21,21,21,21,25,0,0,208,16,144,16,16,220,0,0,6,9,9,9,9,6,0,0,72,80,96,80,72,72,0,60,66,129,129,129,129,66,60,60,66,153,189,189,153,66,60]),Je={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9," ":10,"%":11,S:12,c:13,o:14,r:15,e:16,L:17,v:18,l:19,i:20,s:21,T:22,m:23};function Qe(e,r,i){const n=e.charCodeAt(0);if(n<32||n>127)return;const o=(n-32)*8;for(let l=0;l<8;l++){const s=ze[o+l];for(let a=0;a<8;a++)s&128>>a&&A(r+a,i+l,1)}}function M(e,r,i){const n=i.toUpperCase();for(let o=0;o<n.length;o++)Qe(n[o],(r+o)*8,e*8)}function $e(e,r,i){const n=Je[e];if(n===void 0)return;const o=n*8;for(let l=0;l<8;l++){const s=je[o+l];for(let a=0;a<8;a++)s&128>>a&&(A(r+a,i+l*2,1),A(r+a,i+l*2+1,1))}}function W(e,r,i){for(let n=0;n<i.length;n++)$e(i[n],(r+n)*8,e*8)}function oe(e,r){const i=Math.floor((S-r.length)/2);return M(e,i,r),i}const et=[255,195,129,129,129,129,195,255],tt=[0,60,66,66,66,66,60,0],rt=[0,60,114,122,126,126,60,0],it=[0,60,106,86,106,86,60,0];function Z(e,r,i){const n=e*2-3,o=r*2-3;for(let l=0;l<8;l++){const s=et[l],a=i[l];for(let f=0;f<8;f++){const c=7-f;s>>c&1||A(n+f,o+l,a>>c&1)}}}function nt(e,r){const i=e*2,n=r*2;A(i,n,1),A(i+1,n,1),A(i,n+1,1),A(i+1,n+1,1)}const ot=[[0,0,0],[0,0,255],[255,0,0],[255,0,255],[0,255,0],[0,255,255],[255,255,0],[255,255,255]],lt=[[0,0,0],[0,0,208],[208,0,0],[208,0,208],[0,208,0],[0,208,208],[208,208,0],[208,208,208]];function at(){const e=Te(),r=Re(),i=e.data;for(let n=0;n<k;n++){const o=n>>3,l=n*b,s=o*S;for(let a=0;a<b;a++){const f=P[s+(a>>3)],c=f>>6&1,d=f>>3&7,y=f&7,u=c?ot:lt,v=$[l+a]?u[y]:u[d],C=l+a<<2;i[C]=v[0],i[C+1]=v[1],i[C+2]=v[2],i[C+3]=255}}r.putImageData(e,0,0)}function st(){for(let e=g;e<=T;e++)for(let r=h;r<=R;r++){const i=t.grid[e][r];if(i===m)continue;const n=r*2,o=e*2,l=Ee[i];A(n,o,l[0]>>7-(n&7)&1),A(n+1,o,l[0]>>7-(n+1&7)&1),A(n,o+1,l[1]>>7-(n&7)&1),A(n+1,o+1,l[1]>>7-(n+1&7)&1)}}function ft(){for(const e of t.sparks)e.active&&nt(e.x,e.y);t.trailCursor.active&&Z(t.trailCursor.x,t.trailCursor.y,it);for(const e of t.chasers)e.active&&Z(e.x,e.y,rt);t.deathAnimTimer<=0&&Z(t.player.x,t.player.y,tt)}function ct(){const e=_e().toString().padStart(5,"0"),r=(t.level+1).toString().padStart(2,"0"),i=t.lives.toString(),n="Score "+e+"   Level "+r+"   Lives "+i;W(0,0,n);const o=_(!0,0,5);U(0,o),U(1,o),W(2,0,"Time");const l=40,s=17,a=13,f=t.timer;f>0&&w(l,s,f,a,1);const c=t.percentage.toString().padStart(3,"0")+"%";W(2,28,c);const d=t.timer>=40?_(!0,0,4):_(!0,0,2);for(let y=2;y<=3;y++)I(y,0,5,o),I(y,5,22,d),ye(27,y,o),I(y,28,4,_(!0,0,7))}function ut(){$.fill(0),P.fill(0);const e=Q[t.level&15];for(let i=4;i<B;i++)U(i,e);st(),ft(),ct();const r=_(!0,0,Me());if(t.gameOver){for(let u=4;u<B;u++)for(let v=0;v<S;v++){const C=u*S+v;P[C]&=-65}const i=11,n=8,o=16,l=t.gameOverOutOfTime?7:5,s=n*8,a=i*8,f=o*8,c=l*8;w(s,a,f,c,0),w(s,a,f,1,1),w(s,a+c-1,f,1,1),w(s,a,1,c,1),w(s+f-1,a,1,c,1);const d=[112,120,64,72,80,88,96,104];let y;if(t.gameOverFrame<32){const u=Math.floor(t.gameOverFrame/2)&7;y=d[u]}else y=104;for(let u=i;u<i+l;u++)I(u,n,o,y);if(t.gameOverOutOfTime){const u="OUT OF TIME";M(13,Math.floor(n+(o-u.length)/2),u);const v="GAME OVER";M(15,Math.floor(n+(o-v.length)/2),v)}else{const u="GAME OVER";M(13,Math.floor(n+(o-u.length)/2),u)}}if(t.lcAnim.active){for(let C=4;C<B;C++)for(let Y=0;Y<S;Y++)P[C*S+Y]&=-65;const i=11,n=7,o=18,l=5,s=n*8,a=i*8,f=o*8,c=l*8;w(s,a,f,c,0),w(s,a,f,1,1),w(s,a+c-1,f,1,1),w(s,a,1,c,1),w(s+f-1,a,1,c,1);const d=[112,120,64,72,80,88,96,104],y=t.lcAnim;let u;y.phase===0&&y.frame<32?u=d[Math.floor(y.frame/2)&7]:u=104;for(let C=i;C<i+l;C++)I(C,n,o,u);const v="SCREEN COMPLETED";M(13,Math.floor(n+(o-v.length)/2),v)}if(t.paused&&!t.gameOver&&!t.lcAnim.active){for(let i=11;i<13;i++)U(i,r);w(0,88,b,16,0),oe(11,"PAUSED"),oe(12,"P TO RESUME")}at()}const le=1e3/Oe;let j=0,q=0;function me(e){const r=e-j;for(j=e,q+=r;q>=le;)qe(),q-=le;ut(),requestAnimationFrame(me)}Fe();Pe();fe();requestAnimationFrame(e=>{j=e,me(e)});</script>
</head>
<body>
<canvas id="game"></canvas>
<div id="info">
  <b>Arrows</b> = Move &nbsp; <b>Space</b> = Fire (start drawing / slow mode while drawing)<br>
  Claim <b>75%</b> of the field to complete a level. Avoid chasers, sparks, and the trail cursor!
</div>
<script>
  var NATIVE_W = 256;
  var NATIVE_H = 192;
  var PADDING = 40;
  var INFO_GAP = 12;
  var INFO_FALLBACK_H = 60;
  var MIN_SCALE = 1;

  function scaleCanvas() {
    var c = document.getElementById("game");
    var info = document.getElementById("info");
    var infoH = info ? info.offsetHeight + INFO_GAP : INFO_FALLBACK_H;
    var s = Math.max(MIN_SCALE, Math.min(
      Math.floor((window.innerWidth - PADDING) / NATIVE_W),
      Math.floor((window.innerHeight - infoH - PADDING) / NATIVE_H)
    ));
    c.style.width = (NATIVE_W * s) + "px";
    c.style.height = (NATIVE_H * s) + "px";
  }
  scaleCanvas();
  window.addEventListener("resize", scaleCanvas);
</script>
</body>
</html>
